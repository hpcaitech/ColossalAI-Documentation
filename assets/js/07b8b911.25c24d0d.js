"use strict";(self.webpackChunkagile_docs=self.webpackChunkagile_docs||[]).push([[3539],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return d}});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=i.createContext({}),s=function(e){var n=i.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=s(e.components);return i.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},f=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),f=s(t),d=r,g=f["".concat(c,".").concat(d)]||f[d]||p[d]||o;return t?i.createElement(g,a(a({ref:n},u),{},{components:t})):i.createElement(g,a({ref:n},u))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=f;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var s=2;s<o;s++)a[s]=t[s];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}f.displayName="MDXCreateElement"},9073:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return u},default:function(){return f}});var i=t(3117),r=t(102),o=(t(7294),t(3905)),a=["components"],l={},c="Define Your Configuration",s={unversionedId:"basics/define_your_config",id:"version-v0.2.2/basics/define_your_config",title:"Define Your Configuration",description:"Author: Guangyang Lu, Shenggui Li, Siqi Mai",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-v0.2.2/basics/define_your_config.md",sourceDirName:"basics",slug:"/basics/define_your_config",permalink:"/docs/basics/define_your_config",tags:[],version:"v0.2.2",frontMatter:{}},u=[{value:"Introduction",id:"introduction",children:[],level:2},{value:"Configuration Definition",id:"configuration-definition",children:[{value:"Feature Specification",id:"feature-specification",children:[],level:3},{value:"Global Hyper-parameters",id:"global-hyper-parameters",children:[],level:3}],level:2}],p={toc:u};function f(e){var n=e.components,t=(0,r.Z)(e,a);return(0,o.kt)("wrapper",(0,i.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"define-your-configuration"},"Define Your Configuration"),(0,o.kt)("p",null,"Author: Guangyang Lu, Shenggui Li, Siqi Mai"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Prerequisite:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/concepts/distributed_training"},"Distributed Training")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/concepts/colossalai_overview"},"Colossal-AI Overview"))),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"In Colossal-AI, a configuration file is required to specify the features the system will inject into the training process.\nIn this tutorial, we will introduce you how to construct your configuration file and how this config file will be used.\nUsing configuration file has several advantages:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"You can store your feature configuration and training hyper-parameters in different configuration files"),(0,o.kt)("li",{parentName:"ol"},"New features released in the future can be specified in the configuration without code change in the training script")),(0,o.kt)("p",null,"In this tutorial, we will cover how to define your configuration file."),(0,o.kt)("h2",{id:"configuration-definition"},"Configuration Definition"),(0,o.kt)("p",null,"In a configuration file, there are two types of variables. One serves as feature specification and the other serves\nas hyper-parameters. All feature-related variables are reserved keywords. For example, if you want to use mixed precision\ntraining, you need to use the variable name ",(0,o.kt)("inlineCode",{parentName:"p"},"fp16")," in the config file and follow a pre-defined format."),(0,o.kt)("h3",{id:"feature-specification"},"Feature Specification"),(0,o.kt)("p",null,"There is an array of features Colossal-AI provides to speed up training. Each feature is defined by a corresponding field\nin the config file. In this tutorial, we are not giving the config details for all the features, but rather we are providing\nan illustration of how to specify a feature. ",(0,o.kt)("strong",{parentName:"p"},"The details of each feature can be found in its respective tutorial.")),(0,o.kt)("p",null,"To illustrate the use of config file, we use mixed precision training as an example here. In order to do so, you need to\nfollow the steps below."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"create a configuration file (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"config.py"),", the file name can be anything)")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"define the mixed precision configuration in the config file. For example, in order to use mixed precision training\nnatively provided by PyTorch, you can just write these lines of code below into your config file."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-python"},"from colossalai.amp import AMP_TYPE\n\nfp16 = dict(\n  mode=AMP_TYPE.TORCH\n)\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Tell Colossal-AI where your config file is when launch the distributed environment. For example, the config file is in\nthe current directory."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-python"},"import colossalai\n\ncolossalai.launch(config='./config.py', ...)\n")))),(0,o.kt)("p",null,"In this way, Colossal-AI knows what features you want to use and will inject this feature during ",(0,o.kt)("inlineCode",{parentName:"p"},"colossalai.initialize"),"."),(0,o.kt)("h3",{id:"global-hyper-parameters"},"Global Hyper-parameters"),(0,o.kt)("p",null,"Besides feature specification, the config file can also serve as a place to define your training hyper-parameters. This\ncomes handy when you want to perform multiple experiments, each experiment details can be put into a single config file\nto avoid confusion. These parameters will be stored in the global parallel context and can be accessed in the training script."),(0,o.kt)("p",null,"For example, you can specify the batch size in your config file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"BATCH_SIZE = 32\n")),(0,o.kt)("p",null,"After launch, you are able to access your hyper-parameters through global parallel context."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"import colossalai\nfrom colossalai.core import global_context as gpc\n\ncolossalai.launch(config='./config.py', ...)\n\n# access your parameter\nprint(gpc.config.BATCH_SIZE)\n\n")))}f.isMDXComponent=!0}}]);