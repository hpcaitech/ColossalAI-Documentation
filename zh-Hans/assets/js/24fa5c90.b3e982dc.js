"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[1776],{6999:(a,e,t)=>{t.d(e,{Cl:()=>p,Dx:()=>i,Pc:()=>s,aE:()=>m,e_:()=>c,iz:()=>l,nT:()=>o});var n=t(7294),r=t(398);t(814);function p(a){return n.createElement("div",{className:"docstring-container"},a.children)}function s(a){return n.createElement("div",{className:"signature"},"(",a.children,")")}function l(a){return n.createElement("div",{class:"divider"},n.createElement("span",{class:"divider-text"},a.name))}function m(a){return n.createElement("div",null,n.createElement(l,{name:"Parameters"}),n.createElement(r.D,null,a.children))}function o(a){return n.createElement("div",null,n.createElement(l,{name:"Returns"}),n.createElement(r.D,null,`${a.name}: ${a.desc}`))}function i(a){return n.createElement("div",{className:"title-container"},n.createElement("div",{className:"title-module"},n.createElement("h5",null,a.type),"\xa0 ",n.createElement("h3",null,a.name)),n.createElement("div",{className:"title-source"},"<",n.createElement("a",{href:a.source,className:"title-source"},"source"),">"))}function c(a){return n.createElement("div",null,n.createElement(l,{name:"Example"}),n.createElement(r.D,null,a.code))}},2983:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>N,frontMatter:()=>s,metadata:()=>m,toc:()=>i});var n=t(7462),r=(t(7294),t(3905)),p=t(6999);const s={},l="Shardformer",m={unversionedId:"features/shardformer",id:"features/shardformer",title:"Shardformer",description:"Author: Baizhou Zhang, Bin Jia",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/features/shardformer.md",sourceDirName:"features",slug:"/features/shardformer",permalink:"/zh-Hans/docs/features/shardformer",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/features/shardformer.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Booster Checkpoint",permalink:"/zh-Hans/docs/basics/booster_checkpoint"},next:{title:"\u81ea\u52a8\u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3",permalink:"/zh-Hans/docs/features/mixed_precision_training_with_booster"}},o={},i=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"\u652f\u6301\u4fe1\u606f",id:"\u652f\u6301\u4fe1\u606f",level:2},{value:"\u7528\u6cd5",id:"\u7528\u6cd5",level:2},{value:"Shardformer\u7684\u53c2\u6570\u914d\u7f6e",id:"shardformer\u7684\u53c2\u6570\u914d\u7f6e",level:3},{value:"\u542f\u52a8Shardformer",id:"\u542f\u52a8shardformer",level:3},{value:"1. \u901a\u8fc7Booster\u542f\u52a8Shardformer (\u63a8\u8350)",id:"1-\u901a\u8fc7booster\u542f\u52a8shardformer-\u63a8\u8350",level:4},{value:"2. \u901a\u8fc7Shardformer API\u542f\u52a8Shardformer (\u4e0d\u63a8\u8350)",id:"2-\u901a\u8fc7shardformer-api\u542f\u52a8shardformer-\u4e0d\u63a8\u8350",level:4},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:3},{value:"Shardformer\u7684\u5de5\u4f5c\u539f\u7406",id:"shardformer\u7684\u5de5\u4f5c\u539f\u7406",level:2},{value:"\u8bbe\u8ba1\u601d\u60f3",id:"\u8bbe\u8ba1\u601d\u60f3",level:3},{value:"\u5e8f\u5217\u5e76\u884c Sequence Parallelism",id:"\u5e8f\u5217\u5e76\u884c-sequence-parallelism",level:3}],c={toc:i},k="wrapper";function N(a){let{components:e,...t}=a;return(0,r.kt)(k,(0,n.Z)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"shardformer"},"Shardformer"),(0,r.kt)("p",null,"Author: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Fridge003"},"Baizhou Zhang"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/FoolPlayer"},"Bin Jia")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u9884\u5907\u77e5\u8bc6")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/zh-Hans/docs/concepts/paradigms_of_parallelism"},"\u5e76\u884c\u6280\u672f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/zh-Hans/docs/basics/booster_api"},"Booster API")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/zh-Hans/docs/basics/booster_plugins"},"Booster \u63d2\u4ef6"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u793a\u4f8b\u4ee3\u7801")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/hpcaitech/ColossalAI/tree/main/colossalai/shardformer/examples"},"\u4f7f\u7528Shardformer\u8fdb\u884c\u5f20\u91cf\u5e76\u884c\u8bad\u7ec3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/hpcaitech/ColossalAI/tree/main/examples/language/bert"},"\u901a\u8fc7HybridParallelPlugin\u4f7f\u7528Shardformer"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u76f8\u5173\u8bba\u6587")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/2104.04473"},"Efficient Large-Scale Language Model Training on GPU Clusters Using Megatron-LM")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/1811.06965"},"GPipe: Efficient Training of Giant Neural Networks using Pipeline Parallelism")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/2307.08691"},"FlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/2105.13120"},"Sequence Parallelism: Long Sequence Training from System Perspective")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/2205.05198"},"Reducing Activation Recomputation in Large Transformer Models"))),(0,r.kt)("h2",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),(0,r.kt)("p",null,"\u5728\u8bad\u7ec3LLaMa-2 70B\u6216OPT 175B\u7b49\u5927\u578bTransformer\u6a21\u578b\u65f6\uff0c\u4e3a\u4e86\u6ee1\u8db3GPU\u5185\u5b58\u7684\u9650\u5236\uff0c\u5c06\u5927\u578b\u6a21\u578b\u5212\u5206\u4e3a\u66f4\u5c0f\u7684\u5206\u7247\u7684\u6a21\u578b\u5e76\u884c\u65b9\u6cd5\uff08\u5305\u62ec\u5f20\u91cf\u5e76\u884c\u4ee5\u53ca\u6d41\u6c34\u7ebf\u5e76\u884c\uff09\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002\u7136\u800c\uff0c\u5bf9\u4e8e\u4e0d\u719f\u6089\u5206\u5e03\u5f0f\u8bad\u7ec3\u7684\u7528\u6237\u6765\u8bf4\uff0c\u624b\u52a8\u526a\u5207\u6a21\u578b\u5e76\u91cd\u5199\u5176\u524d\u5411/\u53cd\u5411\u903b\u8f91\u53ef\u80fd\u5f88\u56f0\u96be\u3002\u4e0e\u6b64\u540c\u65f6\uff0cHuggingface transformers\u5f00\u6e90\u5e93\u6b63\u5728\u9010\u6e10\u6210\u4e3a\u7528\u6237\u6a21\u578b\u6765\u6e90\u7684\u9996\u9009\uff0c\u5927\u90e8\u5206\u4e3b\u6d41\u5927\u578b\u6a21\u578b\u90fd\u5df2\u5728Huggingface transformers\u6a21\u578b\u5e93\u4e2d\u5f00\u6e90\u3002"),(0,r.kt)("p",null,"\u51fa\u4e8e\u8fd9\u79cd\u52a8\u673a\uff0cColossalAI\u56e2\u961f\u5f00\u53d1\u4e86",(0,r.kt)("strong",{parentName:"p"},"Shardformer"),"\uff0c\u8be5\u529f\u80fd\u53ef\u4ee5\u81ea\u52a8\u4e3aHuggingFace\u4e2d\u4e3b\u6d41\u7684Transformer\u6a21\u578b\u8fdb\u884c\u5c01\u88c5\uff0c\u7528\u4e8e\u5f20\u91cf\u5e76\u884c\u4ee5\u53ca\u6d41\u6c34\u7ebf\u5e76\u884c\u7684\u8bad\u7ec3\u7b56\u7565\u3002\u5982\u6b64\u4e00\u6765\uff0c\u5bf9\u7cfb\u7edf\u4e86\u89e3\u4e0d\u591a\u7684\u7528\u6237\u4e5f\u53ef\u4ee5\u8f7b\u677e\u5730\u5728transformers\u6a21\u578b\u4e0a\u8fdb\u884c\u5e76\u884c\u8bad\u7ec3\uff1a\u53ea\u9700\u51e0\u884c\u4ee3\u7801\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u5c06\u6a21\u578b\u8f6c\u53d8\u4e3a\u5e76\u884c\u8bad\u7ec3\u7684\u72b6\u6001\u3002\u6b64\u5916\uff0cShardformer\u4e5f\u5305\u62ec\u4e86\u591a\u79cd\u4f18\u5316\u5de5\u5177\uff0c\u7528\u4e8e\u5728\u524d\u5411/\u540e\u5411\u7684\u4f20\u9012\u8fc7\u7a0b\u4e2d\u5b9e\u73b0\u52a0\u901f\u548c\u8282\u7701\u5185\u5b58\u3002"),(0,r.kt)("h2",{id:"\u652f\u6301\u4fe1\u606f"},"\u652f\u6301\u4fe1\u606f"),(0,r.kt)("p",null,"\u6a21\u578b/\u529f\u80fd \u517c\u5bb9\u6027\u77e9\u9635\uff1a"),(0,r.kt)("table",null,(0,r.kt)("tr",null,(0,r.kt)("th",{nowrap:"nowrap"},"Model/Feature"),(0,r.kt)("th",{nowrap:"nowrap",title:"Tensor Parallel"},"Tensor",(0,r.kt)("br",null),"Parallel"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"Pipeline Parallel"},"Pipeline",(0,r.kt)("br",null),"Parallel"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"Lazy Initialization"},"Lazy",(0,r.kt)("br",null),"Initialization"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"xFormers"},"xFormers"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"Flash Attention 2"},"Flash",(0,r.kt)("br",null),"Attention 2"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"JIT Fused Operators"},"JIT Fused",(0,r.kt)("br",null),"Operators"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"Fused LayerNorm"},"Fused",(0,r.kt)("br",null),"LayerNorm"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"Sequence Parallel"},"Sequence",(0,r.kt)("br",null),"Parallel"),(0,r.kt)("th",{nowrap:"nowrap",align:"center",title:"Sequence Overlap"},"Sequence",(0,r.kt)("br",null),"Overlap")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"Llama V1/V2"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"OPT"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"BLOOM"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"ChatGLM 2"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"BERT"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"GPT 2"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"T5"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"ViT"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"Whisper"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"SAM"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c")),(0,r.kt)("tr",null,(0,r.kt)("td",{nowrap:"nowrap"},"Blip2"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u2714\ufe0f"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c"),(0,r.kt)("td",{nowrap:"nowrap",align:"center"},"\u274c")),(0,r.kt)("tr",null,(0,r.kt)("td",{colspan:"39"}))),(0,r.kt)("p",null,"\u6211\u4eec\u8ba1\u5212\u5728\u4e0d\u4e45\u540e\u4e3aShardformer\u652f\u6301\u7684\u6a21\u578b:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"RoBERTa"),(0,r.kt)("li",{parentName:"ul"},"ALBERT"),(0,r.kt)("li",{parentName:"ul"},"ERNIE"),(0,r.kt)("li",{parentName:"ul"},"GPT Neo"),(0,r.kt)("li",{parentName:"ul"},"GPT-J"),(0,r.kt)("li",{parentName:"ul"},"BEiT"),(0,r.kt)("li",{parentName:"ul"},"SwinTransformer V1/V2"),(0,r.kt)("li",{parentName:"ul"},"qwen")),(0,r.kt)("p",null,"\u968f\u7740\u672a\u6765\u66f4\u591a\u6a21\u578b\u548c\u4f18\u5316\u5de5\u5177\u7684\u51fa\u73b0\uff0c\u6211\u4eec\u652f\u6301\u7684\u6a21\u578b/\u4f18\u5316\u5de5\u5177\u5c06\u4f1a\u53d8\u5f97\u8d8a\u6765\u8d8a\u591a\u3002\u5982\u679c\u60a8\u5bf9\u6211\u4eec\u5e94\u8be5\u652f\u6301\u7684\u6a21\u578b/\u4f18\u5316\u5de5\u5177\u6709\u4efb\u4f55\u5efa\u8bae\uff0c\u6b22\u8fce\u5728\u9879\u76ee\u7684",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hpcaitech/ColossalAI/issues"},"Issues"),"\u677f\u5757\u53c2\u4e0e\u8ba8\u8bba\u3002"),(0,r.kt)("h2",{id:"\u7528\u6cd5"},"\u7528\u6cd5"),(0,r.kt)("h3",{id:"shardformer\u7684\u53c2\u6570\u914d\u7f6e"},"Shardformer\u7684\u53c2\u6570\u914d\u7f6e"),(0,r.kt)("p",null,"Shardformer\u7684\u914d\u7f6e\u7531\u7c7b",(0,r.kt)("inlineCode",{parentName:"p"},"ShardConfig"),"\u7684\u53c2\u6570\u63a7\u5236\uff1a"),(0,r.kt)(p.Cl,{mdxType:"DocStringContainer"},(0,r.kt)("div",null,(0,r.kt)(p.Dx,{type:"class",name:"colossalai.shardformer.ShardConfig",source:"https://github.com/hpcaitech/ColossalAI/blob/main/colossalai/shardformer/shard/shard_config.py#L13",mdxType:"Title"}),(0,r.kt)(p.Pc,{mdxType:"Signature"},"tensor_parallel_process_group: typing.Optional[torch.distributed.distributed_c10d.ProcessGroup] = None, pipeline_stage_manager: typing.Optional[colossalai.pipeline.stage_manager.PipelineStageManager] = None, enable_tensor_parallelism: bool = True, enable_fused_normalization: bool = False, enable_flash_attention: bool = False, enable_jit_fused: bool = False, enable_all_optimization: bool = False, inference_only: bool = False, inference_gptq: bool = False, enable_sequence_parallelism: bool = False, enable_sequence_overlap: bool = False"),(0,r.kt)(p.aE,{mdxType:"Parameters"},"- **tensor_parallel_process_group** (Optional[ProcessGroup]) -- The process group of tensor parallelism, it's necessary when using tensor parallel. Defaults to None, which is the global process group.\n- **pipeline_stage_manager** (Optional[PipelineStageManager]) -- If using pipeline parallelism, it's necessary to specify a pipeline stage manager for inter-process communication in pipeline parallelism. Defaults to None, which means not using pipeline parallelism.\n- **enable_tensor_parallelism** (bool) -- Whether to use tensor parallelism. Defaults to True.\n- **enable_fused_normalization** (bool) -- Whether to use fused layernorm. Defaults to False.\n- **enable_flash_attention** (bool, optional) -- Whether to switch on flash attention. Defaults to False.\n- **enable_jit_fused** (bool, optional) -- Whether to switch on JIT fused operators. Defaults to False.\n- **enable_sequence_parallelism** (bool) -- Whether to turn on sequence parallelism, which partitions non-tensor-parallel regions along the sequence dimension. Defaults to False.\n- **enable_sequence_overlap** (bool) -- Whether to turn on sequence overlap, wheich overlap the computation and communication in sequence parallelism. It can only be used when enable_sequence_parallelism is True. Defaults to False.\n- **enable_all_optimization** (bool) -- Whether to turn on all optimization tools including 'fused normalizaion', 'flash attention', 'JIT fused operators', 'sequence parallelism' and 'sequence overlap'. Defaults to False.\n- **inference_only** (bool) -- Whether only doing forward passing. Defaults to False.")),(0,r.kt)("div",null,(0,r.kt)(p.iz,{name:"Description",mdxType:"Divider"}),(0,r.kt)("p",null,"The config for sharding the huggingface model"))),(0,r.kt)("p",null,"\u5982\u679c\u60a8\u60f3\u542f\u7528 Apex Fused Layernorm\uff0c\u8bf7\u5b89\u88c5 ",(0,r.kt)("inlineCode",{parentName:"p"},"apex"),"\u3002\u5982\u679c\u60a8\u60f3\u542f\u7528 flash attention\uff0c\u8bf7\u5b89\u88c5 ",(0,r.kt)("inlineCode",{parentName:"p"},"flash_attn"),"\u3002\u6b64\u5916\uff0cxFormers \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"cutlass_op")," \u53ef\u4ee5\u4f5c\u4e3aFlash Attention\u7684\u8865\u5145\u4f18\u5316\u65b9\u5f0f\u3002"),(0,r.kt)("h3",{id:"\u542f\u52a8shardformer"},"\u542f\u52a8Shardformer"),(0,r.kt)("h4",{id:"1-\u901a\u8fc7booster\u542f\u52a8shardformer-\u63a8\u8350"},"1. \u901a\u8fc7Booster\u542f\u52a8Shardformer (\u63a8\u8350)"),(0,r.kt)("p",null,"\u901a\u8fc7\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"HybridParallelPlugin"),"\u521d\u59cb\u5316\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"Booster"),"\u6765\u542f\u52a8",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u662f\u6700\u63a8\u8350\u7684\u7528\u6cd5\u3002\u5176\u4e3b\u8981\u539f\u56e0\u662f\u5982\u679c\u4e0d\u8c03\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"Booster"),"\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"execute_pipeline"),"\u65b9\u6cd5\uff0c\u6d41\u6c34\u7ebf\u5e76\u884c\u5c31\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u3002\u6b64\u5916\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"HybridParallelPlugin"),"\u63d0\u4f9b\u4e86\u5c06",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u7684\u529f\u80fd\u4e0e\u5176\u4ed6\u529f\u80fd\uff08\u4f8b\u5982\u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3\u6216Zero\uff09\u76f8\u7ed3\u5408\u7684\u80fd\u529b\u3002"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/hpcaitech/ColossalAI/tree/main/examples/language/bert"},"\u8fd9\u91cc"),"\u662f\u4e00\u4e2a\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"p"},"HybridParallelPlugin"),"\u542f\u52a8",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u7684\u793a\u4f8b\u3002\n\u79fb\u52a8\u5230\u793a\u4f8b\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u6267\u884c\u547d\u4ee4\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'torchrun --standalone --nproc_per_node 4  finetune.py --target_f1 0.86 --plugin "hybrid_parallel" --model_type "bert"\n')),(0,r.kt)("p",null,"\u4f60\u4fbf\u53ef\u4ee5\u5fae\u8c03\u4e00\u4e2a\u88ab",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u5c01\u88c5\u8fc7\u7684Bert\u6a21\u578b\uff0c\u800c\u5c01\u88c5\u7684\u64cd\u4f5c\u662f\u7531",(0,r.kt)("inlineCode",{parentName:"p"},"HybridParallelPlugin"),"\u5b8c\u6210\u7684\u3002"),(0,r.kt)("p",null,"\u63a5\u4e0b\u6765\u4e00\u8d77\u6df1\u5165\u6316\u6398\u4e00\u4e0b",(0,r.kt)("inlineCode",{parentName:"p"},"finetune.py"),"\u91cc\u7684\u4ee3\u7801\uff1a"),(0,r.kt)("p",null,"\u5728",(0,r.kt)("inlineCode",{parentName:"p"},"main"),"\u51fd\u6570\u4e2d\uff0c\u6df7\u5408\u5e76\u884c\u7684\u63d2\u4ef6\u901a\u8fc7\u4ee5\u4e0b\u7684\u4ee3\u7801\u521b\u5efa"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'...\nelif args.plugin == "hybrid_parallel":\n    # modify the param accordingly for finetuning test cases\n    plugin = HybridParallelPlugin(\n        tp_size=1,\n        pp_size=2,\n        num_microbatches=None,\n        microbatch_size=1,\n        enable_all_optimization=True,\n        zero_stage=1,\n        precision="fp16",\n        initial_scale=1,\n    )\n')),(0,r.kt)("p",null,"\u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0d\u540c\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"tp_size"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"pp_size")," \u6216 ",(0,r.kt)("inlineCode",{parentName:"p"},"zero_stage"),"\u6765\u6539\u53d8\u63d2\u4ef6\u7684\u914d\u7f6e\u3002\u66f4\u591a\u5173\u4e8e\u63d2\u4ef6\u914d\u7f6e\u7684\u4fe1\u606f\u53ef\u4ee5\u5728",(0,r.kt)("a",{parentName:"p",href:"/zh-Hans/docs/basics/booster_plugins"},"Booster \u63d2\u4ef6\u6587\u6863"),"\u4e2d\u88ab\u627e\u5230\u3002"),(0,r.kt)("p",null,"\u5f53\u6d41\u6c34\u5e76\u884c\u4e0d\u88ab\u542f\u7528\u7684\u65f6\u5019\uff0c\u8bad\u7ec3\u7684\u6d41\u7a0b\u548c\u5176\u4ed6\u7684\u63d2\u4ef6\u662f\u4e00\u6837\u7684 \uff08\u5148\u7528Booster\u5c01\u88c5\u6a21\u578b\u548c\u4f18\u5316\u5668\uff0c\u518d\u7528\u6b63\u5e38\u7684\u65b9\u5f0f\u505a\u524d\u5411\u548c\u540e\u5411\u4f20\u9012\uff09\u3002\u7136\u800c\uff0c\u5f53\u6d41\u6c34\u7ebf\u5e76\u884c\u88ab\u542f\u7528\u7684\u65f6\u5019\uff0c\u6709\u51e0\u5904\u4e0d\u540c\u4e8e\u5bfb\u5e38\u60c5\u51b5\u7684\u7528\u6cd5\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5728\u8fdb\u884c\u524d\u5411\u548c\u540e\u5411\u4e4b\u524d\uff0ccriterion\u51fd\u6570\uff08loss\u51fd\u6570\uff09\u9700\u8981\u88ab\u5904\u7406\u4ee5\u6ee1\u8db3\u6d41\u6c34\u7ebf\u5e76\u884c\u7684\u4f20\u53c2\u8981\u6c42:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},"def _criterion(outputs, inputs):\n    outputs = output_transform_fn(outputs)\n    loss = criterion(outputs)\n    return loss\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"train_epoch")," \u51fd\u6570\u4e2d, dataloader \u5728\u8fdb\u884c\u6d41\u6c34\u7ebf\u7684\u524d\u5411\u540e\u5411\u64cd\u4f5c\u4e4b\u524d\u9700\u8981\u88ab\u8f6c\u6362\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"Iterator")," \u7c7b:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},"train_dataloader_iter = iter(train_dataloader)\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u901a\u8fc7\u8c03\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"Booster.execute_pipeline")," \u65b9\u6cd5\u6765\u6267\u884c\u524d\u5411\u548c\u540e\u5411\u4f20\u9012:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},"outputs = booster.execute_pipeline(\n    train_dataloader_iter, model, _criterion, optimizer, return_loss=True, return_outputs=True\n)\n")),(0,r.kt)("p",{parentName:"li"},"\u8be5\u65b9\u6cd5\u4f1a\u81ea\u52a8\u6267\u884c\u540e\u5411\u4f20\u9012\uff0c\u6240\u4ee5\u5728\u6267\u884c\u8be5\u65b9\u6cd5\u540e\u4e0d\u9700\u8981\u518d\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"loss.backward()"),"\u65b9\u6cd5\u3002\n\u66f4\u591a\u5173\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"Booster.execute_pipeline")," \u7684\u4fe1\u606f\u53ef\u4ee5\u53c2\u8003 ",(0,r.kt)("a",{parentName:"p",href:"/zh-Hans/docs/basics/booster_api"},"Booster API \u6587\u6863"),"\u3002"))),(0,r.kt)("h4",{id:"2-\u901a\u8fc7shardformer-api\u542f\u52a8shardformer-\u4e0d\u63a8\u8350"},"2. \u901a\u8fc7Shardformer API\u542f\u52a8Shardformer (\u4e0d\u63a8\u8350)"),(0,r.kt)("p",null,"\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8\u8c03\u7528Shardformer API\u7684\u65b9\u5f0f\u542f\u52a8Shardformer\u3002\u7136\u800c\u6211\u4eec\u5e76\u4e0d\u63a8\u8350\u8fd9\u79cd\u7528\u6cd5\uff0c\u56e0\u4e3a\u6d41\u6c34\u7ebf\u5e76\u884c\u5728\u6ca1\u6709",(0,r.kt)("inlineCode",{parentName:"p"},"Booster"),"\u7684\u60c5\u51b5\u4e0b\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c\u3002"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/hpcaitech/ColossalAI/blob/main/colossalai/shardformer/examples/convergence_benchmark.py"},"\u8fd9\u91cc"),"\n\u662f\u4e00\u4e2a\u901a\u8fc7\u8c03\u7528Shardformer\u7684API\u542f\u52a8",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u7684\u793a\u4f8b\u3002\n\u5728\u793a\u4f8b\u4ee3\u7801\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"train"),"\u51fd\u6570\u4e2d\uff0c\u6a21\u578b\u88ab\u4ee5\u4e0b\u7684\u51e0\u884c\u4ee3\u7801\u8fdb\u884c\u5c01\u88c5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'...\nif dist.get_world_size() > 1:\n    tp_group = dist.new_group(backend="nccl")\n\n    # First create configuration for Shardformer\n    shard_config = ShardConfig(\n        tensor_parallel_process_group=tp_group,\n        enable_tensor_parallelism=True,\n        enable_all_optimization=True\n    )\n\n    # Then create ShardFormer object with created config\n    shard_former = ShardFormer(shard_config=shard_config)\n\n    # Finally shard the model using ShardFormer.optimize method\n    model, _ = shard_former.optimize(model)\n...\n')),(0,r.kt)("h3",{id:"\u6ce8\u610f\u4e8b\u9879"},"\u6ce8\u610f\u4e8b\u9879"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5f53\u542f\u7528\u6d41\u6c34\u7ebf\u5e76\u884c\u65f6\uff0c\u8bf7\u4e0d\u8981\u7528\u5e38\u89c4\u65b9\u5f0f\uff08",(0,r.kt)("inlineCode",{parentName:"p"},"model(input)"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"loss.backward()"),"\uff09\u8fdb\u884c\u524d\u5411/\u540e\u5411\u4f20\u9012\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u672a\u77e5\u7684\u9519\u8bef\u3002\u8fd9\u79cd\u60c5\u5f62\u4e0b\u8bf7\u901a\u8fc7\u8c03\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"booster.execute_pipeline"),"\u65b9\u6cd5\u6765\u8fdb\u884c\u524d\u5411/\u540e\u5411\u4f20\u9012\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5f53\u4f7f\u7528Shardformer\u5904\u7406",(0,r.kt)("inlineCode",{parentName:"p"},"GPT2ForSequenceClassification"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"ViTForImageClassification"),"\u7b49\u5206\u7c7b\u6a21\u578b\u65f6\uff0c\u8bf7\u786e\u4fddlabels\u7684\u603b\u6570\u4e3a\u5f20\u91cf\u5e76\u884c\u5ea6\u7684\u6574\u6570\u500d\uff0c\u5426\u5219Shardformer\u65e0\u6cd5\u6b63\u786e\u5730\u5904\u7406classifier\u5c42\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u4fee\u590d\u65b9\u6cd5\u5c31\u662f\u5728transformers\u7684config\u4e2d\u6dfb\u52a0\u865a\u62df\u7684\u6807\u7b7e\u3002\u8fd9\u4e00bug\u5c06\u5728 Shardformer\u7684\u672a\u6765\u7248\u672c\u4e2d\u4fee\u590d\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u8bad\u7ec3ChatGLM-2 6B\u7684\u60c5\u51b5\u6709\u70b9\u7279\u6b8a\uff1a\u7531\u4e8eHuggingface Transformers \u76ee\u524d\u5c1a\u672a\u6b63\u5f0f\u652f\u6301ChatGLM\u3002\u5728\u4f7f\u7528Shardformer\u8bad\u7ec3ChatGLM-2\u65f6\uff0c\u8bf7\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5bfc\u5165config/model\u7684\u7c7b\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from colossalai.shardformer.modeling.chatglm2_6b.configuration_chatglm import ChatGLMConfig\nfrom colossalai.shardformer.modeling.chatglm2_6b.modeling_chatglm import ChatGLMForConditionalGeneration, ChatGLMModel\n")),(0,r.kt)("p",{parentName:"li"},"\u5e76\u4e14\u4f7f\u7528\u8fd9\u4e9b\u5bfc\u5165\u7684\u7c7b\u521d\u59cb\u5316\u6a21\u578b\u3002"))),(0,r.kt)("h2",{id:"shardformer\u7684\u5de5\u4f5c\u539f\u7406"},"Shardformer\u7684\u5de5\u4f5c\u539f\u7406"),(0,r.kt)("h3",{id:"\u8bbe\u8ba1\u601d\u60f3"},"\u8bbe\u8ba1\u601d\u60f3"),(0,r.kt)("p",null,"\u901a\u5e38\u6765\u8bf4\uff0cShardformer\u901a\u8fc7\u4ee5\u4e0b\u56db\u79cd\u201c\u66ff\u6362\u201d\u8fdb\u884c\u5de5\u4f5c\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u7528\u6211\u4eec\u8bbe\u8ba1\u7684\u5206\u5e03\u5f0f\u6a21\u5757\u66ff\u6362\u539f\u59cb\u7684PyTorch\u6a21\u5757\uff08\u4f8b\u5982",(0,r.kt)("inlineCode",{parentName:"p"},"nn.Linear"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"nn.Embedding"),"\uff09\u3002\n\u5206\u5e03\u5f0f\u6a21\u5757\u4fdd\u6301\u4e0e\u539f\u59cb\u6a21\u5757\u76f8\u540c\u7684\u5c5e\u6027\uff0c\u4f46\u5206\u5e03\u5f0f\u6a21\u5757\u4f1a\u7528\u65b0\u7684\u53c2\u6570\u66ff\u6362\u539f\u59cb\u6a21\u5757\u7684\u53c2\u6570\u3002\u65b0\u7684\u524d\u5411\u51fd\u6570\u5c06\u53d6\u4ee3\u539f\u6765\u7684\u524d\u5411\u51fd\u6570\uff0c\u7528\u4e8e\u6267\u884c\u5206\u5e03\u5f0f\u8ba1\u7b97\uff0c\u4f8b\u5982\u5728\u5f20\u91cf\u5e76\u884c\u4e0b\u6267\u884c\u7ebf\u6027\u5c42\u7684split/gather\u64cd\u4f5c\u3002\u6bcf\u4e2a\u5206\u5e03\u5f0f\u6a21\u5757\u90fd\u5e94\u5f53\u5b9e\u73b0\u5176",(0,r.kt)("inlineCode",{parentName:"p"},"from_native_module"),"\u9759\u6001\u65b9\u6cd5\uff0c\u4ee5\u5c06PyTorch\u6a21\u5757\u8f6c\u6362\u4e3a\u5176\u76f8\u5e94\u7684\u5206\u5e03\u5f0f\u6a21\u5757\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5c06\u539f\u59cbHuggingface Transformers\u4e2d\u95f4\u5c42\u7684\u5c5e\u6027\u4e3a\u9002\u7528\u4e8e\u5e76\u884c\u8bad\u7ec3\u7684\u5c5e\u6027\u3002\u4f8b\u5982\uff0c\u5f53\u4f7f\u7528\u5e76\u884c\u5ea6\u4e3a2\u7684\u5f20\u91cf\u5e76\u884c\u8bad\u7ec3LlaMa-2\u65f6,",(0,r.kt)("inlineCode",{parentName:"p"},"LlamaDecoderLayer"),"   \u7684\u5c5e\u6027",(0,r.kt)("inlineCode",{parentName:"p"},"num_heads"),"\uff08\u6bcf\u4e00\u5c42\u6ce8\u610f\u529b\u5934\u7684\u6570\u91cf\uff09\u5e94\u66ff\u6362\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"model.config.num_attention_heads // 2"),"\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5c06\u539f\u6765Huggingface transformers\u5e93\u5b9e\u73b0\u7684\u524d\u5411\u51fd\u6570\u66ff\u6362\u4e3a\u6211\u4eec\u5b9a\u5236\u7684\u524d\u5411\u51fd\u6570\u3002\u524d\u5411\u51fd\u6570\u7684\u66ff\u6362\u5bf9\u4e8e\u6d41\u6c34\u7ebf\u5e76\u884c\u6027\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u4e3a\u6d41\u6c34\u7ebf\u5e76\u884c\u9700\u8981\u7279\u6b8a\u7684\u524d\u5411\u51fd\u6570\u53bb\u5728\u4e0d\u540c\u7684\u6d41\u6c34\u7ebf\u9636\u6bb5\u4e4b\u95f4\u4f20\u9012\u4e2d\u95f4\u7684\u9690\u85cf\u72b6\u6001\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u901a\u8fc7\u6211\u4eec\u5b9a\u5236\u7684\u524d\u5411\u51fd\u6570\u5c06\u4f8b\u5982",(0,r.kt)("inlineCode",{parentName:"p"},"flash attention"),"\u6216\u5e8f\u5217\u5e76\u884c\u7684\u4f18\u5316\u65b9\u6cd5\u6ce8\u5165\u5230\u524d\u5411\u7684\u8fc7\u7a0b\u4e2d\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5c06\u5b8c\u6574\u7684\u6a21\u578b\u53c2\u6570\u548c\u4f18\u5316\u5668\u72b6\u6001\u66ff\u6362\u4e3a\u53ea\u7531\u5f53\u524d\u8bbe\u5907\u63a7\u5236\u7684\u90e8\u5206\u6a21\u578b\u53c2\u6570\u548c\u4f18\u5316\u5668\u72b6\u6001\u3002\u901a\u8fc7\u6267\u884c",(0,r.kt)("inlineCode",{parentName:"p"},"ModelSharder.shard"),"\u65b9\u6cd5\uff0c\u5f53\u524d\u8bbe\u5907\u4ec5\u4f1a\u4fdd\u7559\u5b83\u5e94\u8be5\u5904\u7406\u7684\u90a3\u90e8\u5206\u6a21\u578b\u53c2\u6570\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u8fd9\u90e8\u5206\u53c2\u6570\u53ef\u4ee5\u662f\u4f7f\u7528\u5f20\u91cf\u5e76\u884c\u65f6\u5206\u914d\u5230\u5f53\u524d\u673a\u5668\u7684\u53c2\u6570\u5206\u7247\uff0c\u6216\u8005\u4f7f\u7528\u6d41\u6c34\u7ebf\u5e76\u884c\u65f6\u5f53\u524d\u6d41\u6c34\u7ebf\u9636\u6bb5\u7684\u6a21\u578b\u53c2\u6570\uff0c\u6216\u8005\u517c\u800c\u6709\u4e4b\u3002\u9664\u6b64\u4e4b\u5916\u7684\u6240\u6709\u5176\u4ed6\u53c2\u6570\u90fd\u88ab\u91ca\u653e\uff0c\u7528\u4e8e\u8282\u7701\u5185\u5b58\u7684\u7a7a\u95f4\u3002\n\u5982\u6b64\u4e00\u6765\uff0c\u4f18\u5316\u5668\u53ea\u4f1a\u8ba1\u7b97\u4fdd\u7559\u7684\u90e8\u5206\u53c2\u6570\u5bf9\u5e94\u7684\u72b6\u6001\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u8282\u7701\u5185\u5b58\u7684\u4f7f\u7528\u3002"))),(0,r.kt)("p",null,"\u6240\u6709\u8fd9\u4e9b\u66ff\u6362\u90fd\u662f\u901a\u8fc7\u624b\u52a8\u7f16\u5199\u7684\u7b56\u7565\u548c\u524d\u5411\u51fd\u6570\u6765\u5b9e\u73b0\u7684\u3002\u5982\u679c\u60a8\u60f3\u66f4\u6df1\u5165\u5730\u7814\u7a76Shardformer\u7684\u8bbe\u8ba1\u65b9\u6848\uff0c\u6216\u8005\u5b9a\u5236\u60a8\u81ea\u5df1\u7684Shardformer\u7b56\u7565\uff0c\u8bf7\u53c2\u8003",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hpcaitech/ColossalAI/blob/main/colossalai/shardformer/README.md"},"Shardformer \u5f00\u53d1\u8005\u6587\u6863"),"\u548c",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hpcaitech/ColossalAI/discussions/4050"},"\u6d41\u6c34\u5e76\u884c\u8bbe\u8ba1\u65b9\u6848"),"\u4ee5\u83b7\u5f97\u66f4\u591a\u7ec6\u8282\u3002"),(0,r.kt)("h3",{id:"\u5e8f\u5217\u5e76\u884c-sequence-parallelism"},"\u5e8f\u5217\u5e76\u884c Sequence Parallelism"),(0,r.kt)("p",null,"\u5e8f\u5217\u5e76\u884c\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u652f\u6301\u7684\u4e00\u79cd\u7279\u6b8a\u7684\u4f18\u5316\u65b9\u6cd5\u3002\u5728",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u4e2d\uff0c\u5e8f\u5217\u5e76\u884c\u4e0e",(0,r.kt)("a",{parentName:"p",href:"https://colossalai.org/docs/basics/configure_parallelization/#sequence-parallel"},"\u6b64\u5904"),"\u7a0d\u6709\u4e0d\u540c\uff0c\u540e\u8005\u4fa7\u91cd\u4e8ering attention\u3002\u5728",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u4e2d\uff0c\u5e8f\u5217\u5e76\u884c\u4ec5\u4e0e1D\u5f20\u91cf\u5e76\u884c\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u8fdb\u4e00\u6b65\u51cf\u5c11\u8ba1\u7b97\u4e2dactivation\u7684\u5185\u5b58\u5360\u7528\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5728\u666e\u901a\u7684",(0,r.kt)("a",{parentName:"p",href:"https://colossalai.org/docs/features/1D_tensor_parallel"},"1D\u5f20\u91cf\u5e76\u884c"),"\u4e2d\uff0c\u6709\u4e24\u4e2a\u901a\u4fe1\u64cd\u4f5c",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"g")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"g")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"))))),"\u548c",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mover",{parentName:"mrow",accent:"true"},(0,r.kt)("mi",{parentName:"mover"},"g"),(0,r.kt)("mo",{parentName:"mover"},"\u20d7"))),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\vec{g}")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.9084399999999999em",verticalAlign:"-0.19444em"}}),(0,r.kt)("span",{parentName:"span",className:"mord accent"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.714em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"))),(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"accent-body",style:{left:"-0.20772em"}},(0,r.kt)("span",{parentName:"span",className:"overlay",style:{height:"0.714em",width:"0.471em"}},(0,r.kt)("svg",{parentName:"span",width:"0.471em",height:"0.714em",style:{width:"0.471em"},viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},(0,r.kt)("path",{parentName:"svg",d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"})))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.19444em"}},(0,r.kt)("span",{parentName:"span"}))))))))),"\uff0c",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"g")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"g")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"))))),"\u5728\u53cd\u5411\u4f20\u64ad\u4e2d\u8fdb\u884c\u4e00\u6b21\u5168\u5c40\u5f52\u7ea6\u4ee5\u83b7\u53d6\u6765\u81ea\u6240\u6709\u8bbe\u5907\u7684\u68af\u5ea6\uff0c\u800c",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mover",{parentName:"mrow",accent:"true"},(0,r.kt)("mi",{parentName:"mover"},"g"),(0,r.kt)("mo",{parentName:"mover"},"\u20d7"))),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\vec{g}")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.9084399999999999em",verticalAlign:"-0.19444em"}}),(0,r.kt)("span",{parentName:"span",className:"mord accent"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.714em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"))),(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"accent-body",style:{left:"-0.20772em"}},(0,r.kt)("span",{parentName:"span",className:"overlay",style:{height:"0.714em",width:"0.471em"}},(0,r.kt)("svg",{parentName:"span",width:"0.471em",height:"0.714em",style:{width:"0.471em"},viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},(0,r.kt)("path",{parentName:"svg",d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"})))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.19444em"}},(0,r.kt)("span",{parentName:"span"}))))))))),"\u5728\u6b63\u5411\u4f20\u64ad\u4e2d\u8fdb\u884c\u4e00\u6b21All-Reduce\u4ee5\u83b7\u53d6\u6765\u81ea\u6240\u6709\u8bbe\u5907\u7684\u8f93\u51fa\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5f53\u4f7f\u7528\u5e8f\u5217\u5e76\u884c\u65f6\uff0c",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mover",{parentName:"mrow",accent:"true"},(0,r.kt)("mi",{parentName:"mover"},"g"),(0,r.kt)("mo",{parentName:"mover"},"\u20d7"))),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\vec{g}")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.9084399999999999em",verticalAlign:"-0.19444em"}}),(0,r.kt)("span",{parentName:"span",className:"mord accent"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.714em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"))),(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"accent-body",style:{left:"-0.20772em"}},(0,r.kt)("span",{parentName:"span",className:"overlay",style:{height:"0.714em",width:"0.471em"}},(0,r.kt)("svg",{parentName:"span",width:"0.471em",height:"0.714em",style:{width:"0.471em"},viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},(0,r.kt)("path",{parentName:"svg",d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"})))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.19444em"}},(0,r.kt)("span",{parentName:"span"}))))))))),"\u9700\u8981\u5728\u6b63\u5411\u4f20\u64ad\u8fc7\u7a0b\u4e2d\u8fdb\u884cAll-Gather\u4ee5\u83b7\u53d6\u5e8f\u5217\u7ef4\u5ea6\u4e0a\u7684\u8f93\u5165\uff0c\u5e76\u5728\u53cd\u5411\u4f20\u64ad\u8fc7\u7a0b\u4e2d\u8fdb\u884cReduce-Scatter\u4ee5\u5206\u5272\u68af\u5ea6\u3002",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mover",{parentName:"mrow",accent:"true"},(0,r.kt)("mi",{parentName:"mover"},"g"),(0,r.kt)("mo",{parentName:"mover"},"\u20d7"))),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\vec{g}")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.9084399999999999em",verticalAlign:"-0.19444em"}}),(0,r.kt)("span",{parentName:"span",className:"mord accent"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.714em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"))),(0,r.kt)("span",{parentName:"span",style:{top:"-3em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"accent-body",style:{left:"-0.20772em"}},(0,r.kt)("span",{parentName:"span",className:"overlay",style:{height:"0.714em",width:"0.471em"}},(0,r.kt)("svg",{parentName:"span",width:"0.471em",height:"0.714em",style:{width:"0.471em"},viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},(0,r.kt)("path",{parentName:"svg",d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"})))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.19444em"}},(0,r.kt)("span",{parentName:"span"}))))))))),"\u9700\u8981\u8fdb\u884cReduce-Scatter\u4ee5\u5c06\u5e8f\u5217\u7ef4\u5ea6\u4e0a\u7684\u884c\u7ebf\u6027\u5c42\u8f93\u51fa\u5206\u5272\u5230\u6240\u6709\u8bbe\u5907\u4e0a\uff0c\u5e76\u8fdb\u884cAll-Gather\u4ee5\u83b7\u53d6\u5b8c\u6574\u7684\u68af\u5ea6\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528NCCL\u7684All-reduce\u5b9e\u73b0\u91c7\u7528\u4e86",(0,r.kt)("inlineCode",{parentName:"p"},"Ring All-Reduce"),"\u65b9\u6cd5\uff0c\u7531\u4e00\u6b21Reduce-Scatter\u548c\u4e00\u6b21All-Gather\u7ec4\u6210\uff0c\u4e24\u8005\u7684\u5f00\u9500\u76f8\u7b49\u3002\u56e0\u6b64\uff0c\u4e0e\u5e8f\u5217\u5e76\u884c\u548c\u5f20\u91cf\u5e76\u884c\u76f8\u6bd4\uff0c\u5b83\u5e76\u4e0d\u4f1a\u5f15\u5165\u989d\u5916\u7684\u901a\u4fe1\u5f00\u9500\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u5728\u5f20\u91cf\u5e76\u884c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Column Linear")," \u5c42\u4e2d\u8fdb\u884c\u5e8f\u5217\u5e76\u884c\u65f6\uff0c\u68af\u5ea6\u7684\u53cd\u5411\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u9700\u8981\u83b7\u53d6\u5b8c\u6574\u7684\u8f93\u5165\u3002\u5728\u524d\u5411\u4f20\u64ad\u8fc7\u7a0b\u4e2d\uff0c\u4ec5\u4fdd\u7559\u6cbf\u5e8f\u5217\u7ef4\u5ea6\u5206\u5272\u7684\u8f93\u5165\u90e8\u5206\uff0c\u5f20\u91cf\u7684\u5f62\u72b6\u4f8b\u5982",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,r.kt)("mi",{parentName:"mrow"},"b"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"c"),(0,r.kt)("mi",{parentName:"mrow"},"h"),(0,r.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,r.kt)("mi",{parentName:"mrow"},"s"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"q"),(0,r.kt)("mi",{parentName:"mrow"},"u"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mi",{parentName:"mrow"},"c"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"_"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,r.kt)("mi",{parentName:"mrow"},"k"),(0,r.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,r.kt)("mi",{parentName:"mrow"},"h"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"d"),(0,r.kt)("mi",{parentName:"mrow"},"d"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"_"),(0,r.kt)("mi",{parentName:"mrow"},"s"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"s"),(0,r.kt)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"(batch, sequence\\_len/k, hidden\\_states)")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1.06em",verticalAlign:"-0.31em"}}),(0,r.kt)("span",{parentName:"span",className:"mopen"},"("),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"b"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"c"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"h"),(0,r.kt)("span",{parentName:"span",className:"mpunct"},","),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"s"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"q"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"u"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"c"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord",style:{marginRight:"0.02778em"}},"_"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,r.kt)("span",{parentName:"span",className:"mord"},"/"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k"),(0,r.kt)("span",{parentName:"span",className:"mpunct"},","),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"h"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,r.kt)("span",{parentName:"span",className:"mord",style:{marginRight:"0.02778em"}},"_"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"s"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"s"),(0,r.kt)("span",{parentName:"span",className:"mclose"},")"))))),"\u3002\u56e0\u6b64\uff0c\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u5168\u5c40\u6536\u96c6\u64cd\u4f5c\u4ee5\u83b7\u53d6\u5b8c\u6574\u7684\u8f93\u5165\u8fdb\u884c\u68af\u5ea6\u8ba1\u7b97\u3002\u4f46\u662f\uff0c\u5728\u5b9e\u73b0\u4e2d\uff0c\u53ef\u4ee5\u5c06\u68af\u5ea6\u8ba1\u7b97\u4e0e\u5168\u5c40\u6536\u96c6\u901a\u4fe1\u64cd\u4f5c\u91cd\u53e0\uff0c\u8fd9\u4e0d\u4f1a\u5f15\u5165\u989d\u5916\u7684\u901a\u4fe1\u5f00\u9500\uff08\u5bf9\u5e94",(0,r.kt)("inlineCode",{parentName:"p"},"Shardformer"),"\u4e2d\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"enable_sequence_overlap"),"\u53c2\u6570\uff09\u3002"))))}N.isMDXComponent=!0}}]);